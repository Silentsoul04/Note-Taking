|   OSI层    |             功能             |                  协议                   |
| :--------: | :--------------------------: | :-------------------------------------: |
|   应用层   | 文件传输、电子邮件、文件服务 | HTTP、FTP、DNS、URL、HTML、SMTP、Telnet |
|   传输层   |       提供端对端的接口       |                TCP、UDP                 |
|   网络层   |      为数据包选择路由器      |              IP、ARP、ICMP              |
| 数据链路层 | 传输有地址的帧、错误检测功能 |                 网卡层                  |
|   物理层   |           物理媒体           |                  硬件                   |

***

## 客户端/服务器架构

服务器拾一系列的硬件或软件，为客户端提供所需服务。服务器的目的就是：等待客户端的请求，并响应，然后等待接下来的请求。会有以下分类：

* 硬件客户端/服务器：打印服务器、文件服务器
* 软件客户端/服务器：Web服务器、数据库服务器

***

## 通信端口

在服务器响应客户端请求之前，必须执行一系列流程，从而为后来的工作做准备。首先会创建一个通信端口，由此服务器会一直监听请求。位于传输层的通信协议通常需要指定端口号。以下内容来自wiki：[通信端口](https://zh.wikipedia.org/wiki/%E9%80%9A%E8%A8%8A%E5%9F%A0)

在计算机网络中，通信端口（英语：port），又称为通信端口、端口、协议端口（protocol port），是一种经由软件创建的服务，在一个计算机操作系统中扮演通信的端点（endpoint）。每个通信端口都会与主机的IP地址及通信协议关联。通信端口以16比特数字来表示，这被称为通信端口编号（port number）。 

在操作系统上运行的网络软件，可以透过操作系统，利用各个不同的通信端口，将数据发送到网络上；操作系统也可以根据数据包的IP地址以及端口号，将这些数据包转送到匹配的进程去。在操作系统中，一个进程，可以通过internet socket，将它的输入与输出，与一个特定的传输协议，一个通信端口，与IP地址，关系起来。这个关系动作，称为绑定（binding），在这之后，就可以通过网络提交与接收数据。

虽然使用同样传输协议，但是特定的IP地址以及通信端口的组合，只会被绑定到单一的特定进程上。当使用同样协议的多个程序，尝试着绑定在同一个IP地址下的相同通信端口，就会产生一个常见的应用程序错误，这个错误有时候被称为通信端口冲突（port conflicts）。 

### 类型

传输层协议，如传输控制协议（TCP）与用户数据报文协议（UDP），在分组表头中，定义了来源端口号与目的端口号。一个通信端口号使用16位无符号整数（unsigned integer）来表示，其范围介于0与65535之间。在TCP协议中，端口号0是被保留的，不可使用。分为3类：

* 1--1023：系统保留，只能由root用户使用。
* 1024---4999：由客户端程序自由分配。
* 5000---65535：由服务器端程序自由分配在UDP协议中，来源端口号是可以选择要不要填上，如果设为0，则代表没有来源端口号。

### 用途

端口号有2种用途： 

* 标识服务器上提供特定网络服务的进程。客户机可以按照服务器IP与端口号与相应的服务器进程创建网络连接，获得相应的网络服务。例如，通常使用80端口号提供http服务，使用23端口号telnet服务。服务器的这种功能叫做listening。客户机通常使用动态指定的端口号与服务器创建连接。
* 由本机地址、本机端口号、目标机地址、目标机端口号、通信协议组成的五元组，用于唯一确定正在使用的网络链接。因此，对于不同的协议、不同的目标机地址，本机的不同地址（如果本机使用多个网卡）等多种情形，同一个端口号可以复用。因此对于1对1通信，且本机与目标机之间只能创建一个通信连接，则不需要使用端口号。

网络防火墙或者网关还可提供端口转发（port forwarding），即NAT。 

***

## 套接字

套接字体现了通信端口的概念。以下内容来自wiki：[网络套接字](https://zh.wikipedia.org/wiki/%E7%B6%B2%E8%B7%AF%E6%8F%92%E5%BA%A7#cite_note-1)

在计算机科学中，网络套接字（英语：Network socket），又译网络套接字、网络接口、网络插槽，是计算机网络中进程间数据流的端点。使用以网际协议（Internet Protocol）为通信基础的网络套接字，称为网际套接字（Internet socket）。因为网际协议的流行，现代绝大多数的网络套接字，都是属于网际套接字。

socket 是一种操作系统提供的进程间通信机制。进程通信之前，双方首先必须各自创建一个端点，否则是没有办法建立通信。

下图选自《图解TCP/IP》:

![SOCKET](https://wx1.sinaimg.cn/mw690/af9e9c30ly1fy387tfy5dj20pc0ho3yj.jpg)

在操作系统中，通常会为应用程序提供一组应用程序接口（API），称为套接字接口（英语：socket API）。应用程序可以通过套接字接口，来使用网络套接字，以进行数据交换。

在套接字接口中，以IP地址及通信端口组成套接字地址（socket address）。远程的套接字地址，以及本地的套接字地址完成连线后，再加上使用的协议（protocol），这个五元组（five-element tuple），作为套接字对（socket pairs），之后就可以彼此交换数据。例如，在同一台计算机上，TCP协议与UDP协议可以同时使用相同的port而互不干扰。 操作系统根据套接字地址，可以决定应该将数据送达特定的进程或线程。

网络中每个通信实体的 socket 是由一个三元组标识。通信双方之间的一个完整连接是用五元组标识，它是由双方的三元组合成的。五元组往往称为全相关，而三元组往往称为半相关。

要通过 Internet 进行通信，至少需要一对套接字，其中一个运行在客户端，称之为 ClientSocket，另一个运行于服务器端面，称为 ServerSocket。根据连接启动的方式以及本地要连接的目标，套接字之间的连接过程可以分为三个步骤：服务器监听、客户端请求、连接确认。

套接字分为两种：

* 网络：AF_INET（IPv4网络协议）、AF_INET6（IPv6网络协议），广泛用于互联网编程，包括了IP地址和TCP、UDP端口号。
* 本地：AF_UNIX（Unix 域套接字），运行在同一台计算机上的程序间的本地通信，不用于网络通讯。

除此之外，无论使用哪种地址家族的套接字也可以如下分为2类：

* 面向连接：
  * 在进行通信之前必须建立起一个连接。
  * 使用流套接字（SOCK_STREAM）。实现这种连接类型的协议主要是 TCP。
* 无连接：
  * 在进行通信之前不需要建立连接。
  * 使用数据报文套接字（SOCK_DGRAM）。实现这种连接类型的协议主要是 UDP。

PS：

**进程间通信**（IPC，Inter-Process Communication），指至少两个进程或线程间传送数据或信号的一些技术或方法。 进程是计算机系统分配资源的最小单位(严格说来是线程)。每个进程都有自己的一部分独立的系统资源，彼此是隔离的。为了能使不同的进程互相访问资源并进行协调工作，才有了进程间通信。通常，使用进程间通信的两个应用可以被分为客户端和服务器（见主从式架构），客户端进程请求数据，服务端响应客户端的数据请求。有一些应用本身既是服务器又是客户端，这在分布式计算中，时常可以见到。这些进程可以运行在同一计算机上或网络连接的不同计算机上。 

**应用程序接口**（英语：application programming interface，缩写作 API），又称为应用编程接口，就是软件系统不同组成部分衔接的约定。由于近年来软件的规模日益庞大，常常需要把复杂的系统划分成小的组成部分，编程接口的设计十分重要。程序设计的实践中，编程接口的设计首先要使软件系统的职责得到合理划分。良好的接口设计可以降低系统各部分的相互依赖，提高组成单元的内聚性，降低组成单元间的耦合程度，从而提高系统的可维护性和可扩展性。 

**三元组**可以在全局标识唯一的进程：（协议，本地地址，本地端口号）。

**五元组**：一个完整的进程通信由两个进程组成，并且只能使用同一种协议。因此一个完整的通信需要一个五元组来标识：（协议，本地地址，本地端口号，远地地址，远地端口号）。

**TCP 与 UDP 区别**：

* TCP 是面向连接的、可靠的流协议。流就是指不间断的数据结构。提供可靠性传输，实行“顺序控制”或“重发控制”，此外还具有“流控制”、“拥塞控制”等功能。
* UDP 是面向无连接、不具有可靠性的数据报协议。虽然可以确保数据的大小，却不能保证数据会到达。细微的处理交由上层的应用去完成。主要用于对告诉传输和实时性要求较高的通信或广播通信。

***

